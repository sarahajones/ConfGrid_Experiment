
jsPsych.plugins["jspsych-PIS"] = (function() {

    var plugin = {};

    plugin.info = {
        name: "jspsych-PIS",
        prettyName: 'Participant Information Sheet',
        parameters: {}
    };

    plugin.trial = function(display_element) {
// clear display element and apply page default styles
        display_element.innerHTML = '';


        /* create an element in the DOM */
        var PIS_text =
            '<br><h4>1. General Information</h4>'
            + '<p>We appreciate your interest in participating in this online study. You have been invited to participate as you are above the age of 18 years and fluent in English.' +
            ' Please read through this information before agreeing to participate by clicking the button below. ' +
            'You may ask any questions before deciding to take part be contacting the researcher (details below). ' +
            'Thank you for taking the time to read this.</p>'


            + '<br><h4>2. Study Aims:</h4>'

            + '<p> The Attention and Cognitive Control Lab at the University of Oxford are investigating decision making and decision confidence. ' +
            'The aim of this study is to investigate theories about how humans use information from their sense to make category decisions, how we detect our mistakes, and how we have confidence in our decisions. ' +
            'The study aims to put these theories to the test by examining peoples\' decisions and confidence. As a result we hope the study will lead to a better understanding of decision-making and confidence. ' +
            'This could lead to improved training to support doctors when making choices about diagnosis or treatment options, for example.<\p>'


            + '<br><h4>3. Task Description:</h4>'

            + '<p>After reading this information sheet, if you are still happy to take part you will be asked to complete an on-screen consent form. ' +
            'When the research begins, you would be asked to watch images presented on your screen, and to indicate certain responses to these images by pressing buttons. ' +
            'These images will take the form of category sets such as: computer-drawn landscapes with different shape clouds in the sky to be sorted into rainy or non-rainy days; or locations of air-dropped packages to be sorted into good vs. bad packages to retrieve. ' +
            'The stimuli will always be non-threatening and will always take the form of simplistic “cartoon versions” of objects, scenes or symbols. You will also be asked about your level of confidence in your responses to the images. </p>'
            + '<p>The study would take place over a single session lasting about 1 hour in total. You would be asked to monitor the screen for periods of approximately 5 minutes at a time, with breaks between these periods. ' +
            'No background knowledge is required to complete this task. Your responses to the task will be viewed by the researcher and the supervisory team to answer questions about decision making and confidence. </p>'


            + '<br><h4>4. Do I have to take part?</h4>'

            + '<p>No. It is up to you to decide if you want to take part in this study.  We will describe the study and go through this information sheet with you to answer any questions you may have. ' +
            'You can ask questions about the research before deciding whether or not to take part. If you agree to take part, we will ask you to complete a consent form. ' +
            'However, you would still be free to withdraw from the study at any time, without needing to give a reason, by advising us of this decision. ' +
            'If you withdraw early we will use the data you have provided up to that point in our research unless you specify otherwise. It may be impossible to withdraw data after completing the study because of anonymization and aggregation of datasets. </p>'
            + '<p>If you do decide to take part, you may withdraw at any point during the study for any reason before submitting your answers by pressing the ‘Exit’ button/closing the browser. ' +
            'However, we are only able to reimburse participants who complete the full study session, partial responses will not be reimbursed. </p>'


            + '<br><h4>5. How will my data be used?</h4>'

            + '<p>Your answers will be made completely anonymous by separating any personal data from the research data generated by you responses in the study, and we will take all reasonable measures to ensure that your data remain confidential. ' +
            'Your data will be stored in a password-protected file and may be used in academic publications. Your IP address will not be stored. If required, we will use your Prolific ID to contact you within the Prolific Platform. ' +
            'Research data will be stored for a minimum of three years after publication or public release. </p>'


            + '<br><h4>6. Who will have access to my data?</h4>'

            + '<p>The University of Oxford is the data controller with respect to your personal data, and as such will determine how your personal data is used in the study. ' +
            'The University will process your personal data for the purpose of the research outlined above. Research is a task that we perform in the public interest.  ' +
            'Further information about your rights with respect to your personal data is available from https://compliance.admin.ox.ac.uk/individual-rights. </p>'
            + '<p>We would also like your permission to use your anonymised data in future studies, and to share data with other researchers (e.g. in online databases such as the Open science Framework). ' +
            'Any personal information that could identify you will be removed or changed before files are shared with other researchers or results are made public. ' +
            '<b>The anonymised dataset will be shared publicly on the internet on the Open Science Framework</b>, in order to support open and transparent science. ' +
            'Hence, it will be publicly accessible and may be reused by researchers both inside and outside the European Union. Files on the university computer will be destroyed upon completion of upload to OSF. ' +
            'Responsible members of the University of Oxford and funders may be given access to data for monitoring and/or audit of the study to ensure we are complying with guidelines, or as otherwise required by law. </p>'
            + '<p>This project is for a DPhil project. The Principal Researcher is Sarah Ashcroft-Jones, who is attached to the Department of Experimental Psychology at the University of Oxford. ' +
            'This project is being completed under the supervision of Professor Nicholas Yeung.' + '<br>'+
            'This project has been reviewed by, and received ethics clearance through, the University of Oxford Central University Research Ethics Committee ' + CUREC_ID + '.</p>'


            + '<br><h4>7. Who do I contact if I have a concern about the study or I wish to complain??</h4>'

            + '<p>If you have a concern about any aspect of this study, please contact Sarah Ashcroft-Jones (sarah.ashcroft-jones@psy.ox.ac.uk, 01865 271302) or her supervisor Nick Yeung (Nicholas.yeung@psy.ox.ac.uk, 01865 271389), and we will do our best to answer your query.  ' +
            'We will acknowledge your concern within 10 working days and give you an indication of how it will be dealt with. </p>'
            + '<p>If you remain unhappy or wish to make a formal complaint, please contact the Chair of the Research Ethics Committee at the University of Oxford who will seek to resolve the matter as soon as possible:' + '<br>' +
            'Chair, <b>Medical Sciences Inter-Divisional Research Ethics Committee</b>; Email: ethics@medsci.ox.ac.uk; Address: Research Services, University of Oxford, Wellington Square, Oxford OX1 2JD</p>';

        const response = {
            PIS: null,
        };
// create page elements
        var intro = createGeneral(
            intro,
            display_element,
            'div',
            'titlepage document-intro',
            'PIS-intro',
            '<h1>Please read and acknowledge the following information.</h1>'
        );


        var ethicsForm = createGeneral(
            ethicsForm,
            display_element,
            'div',
            'document-in-document',
            'PIS-form',
            ''
        );
        var instructHeader = createGeneral(
            instructHeader,
            ethicsForm,
            'div',
            'document-header',
            'PIS-header',
            ''
        );

        var logo = createGeneral(
            logo,
            instructHeader,
            'div',
            'header-logo',
            'Oxford-logo',
            ''
        );
        var labInfo = createGeneral(
            labInfo,
            instructHeader,
            'div',
            'header-info',
            'header-lab-info',
            '<h2>DEPARTMENT OF EXPERIMENTAL PSYCHOLOGY</h2>'
            + '<h4>New Radcliffe House, Radcliffe Observatory Quarter, Oxford OX2 6GG</h4>'
            + '<b>Professor Nicholas Yeung</b>'
            + '<br>'
            + 'Principal Investigator, Attention & Cognitive Control Lab'
            + '<br>'
            + '<i>Email: nicholas.yeung@psy.ox.ac.uk | Tel: +44 (0)1865 271389</i>'
        );

        var title = createGeneral(
            title,
            ethicsForm,
            'div',
            'document-title',
            'PIS-title',
            '<h1> ELECTRONIC PARTICIPANT INFORMATION SHEET</h1>' +
            '<h3>V' + PIS_version + ' (revised: ' + PIS_date + ')</h3>' +
            '<h3>Central University Research Ethics Committee (CUREC) Approval Reference: '+ CUREC_ID +'</h3>' + '<br>' +
            '<h2>"' + CUREC_studyName + '"</h2>'
        );

        var instructText = createGeneral(
            instructText,
            ethicsForm,
            'div',
            'document-text',
            'PIS-text',
            PIS_text
        );
        var footer = createGeneral(
            footer,
            ethicsForm,
            'div',
            'document-footer',
            'PIS-footer',
            ''
        );
        var instructAcknowledge = createGeneral(
            instructAcknowledge,
            display_element,
            'button',
            'large-button',
            'PIS-submit',
            '<div>I have read and understood this Participant Information Sheet</div>'
        );


        // define what happens when people click on the final submit button
        $('#PIS-submit').on('click', function () {
            response.PIS = true;
            // save the data to data object
            jsPsych.finishTrial(response);
            return;
        });
    }

    return plugin;
})();


